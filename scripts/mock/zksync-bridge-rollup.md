### l1 => l2
#### 1、deposit(address _l2Receiver,address _l1Token,uint256 _amount,uint256 _l2TxGasLimit,uint256 _l2TxGasPerPubdataByte)
* input
```
# 在 deposit 之前授权 _l1Token 给 0x927ddfcc55164a59e0f33918d13a2d559bc10ce7

cast send --gas-price 7732618 --value 571203000000000 --rpc-url https://rpc.ankr.com/eth_goerli --private-key 3e31923426ee6b71e7473bef2759520aa5b40b2446003bd4d43ca0070a9a109e 0x927ddfcc55164a59e0f33918d13a2d559bc10ce7 "deposit(address,address,uint256,uint256,uint256)" 0x20cD8eB93c50BDAc35d6A526f499c0104958e3F6 0x113d7546f66555C8124a71a2886Ac855272e4ab1 1000000000000000000 1142406 800
```
* out
```
...
transactionHash         0xbb05beb318a247e47eb06be31aad28d605762318faf24b90e38724a84d2707b2
transactionIndex        14
```

### 2、讲解
* 参数说明
```
_l2Receiver: l2 上代币接收者
_l1Token: l1 上代币地址
_amount: 转帐金额
_l2TxGasLimit: 如下见解
_l2TxGasPerPubdataByte: 800
value: 
	https://goerli.etherscan.io/address/0x1908e2bf4a88f91e4ef0dc72f02b8ea36bea2319#readProxyContract: l2TransactionBaseCost(uint256 _gasPrice,uint256 _l2GasLimit,uint256 _l2GasPerPubdataByteLimit)
```

* 计算 l2TxGasLimit
```
_l2TxGasLimit 计算方式:
from: l1bridge + 0x1111000000000000000000000000000000001111
to: l2bridge

curl -X POST -H "Content-Type: application/json" \
--data '{"method":"zks_estimateGasL1ToL2","params":[{"from":"0xa38edfcc55164a59e0f33918d13a2d559bc11df8","to":"0x00ff932a6d70e2b8f1eb4919e1e09c1923e7e57b","data":"0xcfe7af7c00000000000000000000000020cd8eb93c50bdac35d6a526f499c0104958e3f600000000000000000000000020cd8eb93c50bdac35d6a526f499c0104958e3f6000000000000000000000000113d7546f66555c8124a71a2886ac855272e4ab10000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000084d7920546f6b656e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000034d5954000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000012","eip712Meta":{"gasPerPubdata":"0x0"}}],"id":73,"jsonrpc":"2.0"}' \
"https://testnet.era.zksync.dev"

```

* 获取 finalizeDeposit 的data
```

///finalizeDeposit(address _l1Sender,address _l2Receiver,address _l1Token,uint256 _amount,bytes calldata _data)
// 

(, bytes memory data1) = _l1Token.staticcall(abi.encodeCall(IERC20Metadata.name, ()));
(, bytes memory data2) = _l1Token.staticcall(abi.encodeCall(IERC20Metadata.symbol, ()));
(, bytes memory data3) = _l1Token.staticcall(abi.encodeCall(IERC20Metadata.decimals, ()));
_data = abi.encode(data1, data2, data3);

cast calldata "finalizeDeposit(address,address,address,uint256,bytes)" 0x20cD8eB93c50BDAc35d6A526f499c0104958e3F6 0x20cD8eB93c50BDAc35d6A526f499c0104958e3F6 0x113d7546f66555C8124a71a2886Ac855272e4ab1 1000000000000000000 0x000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000084d7920546f6b656e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000034d5954000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000012
```
* 获取 value 的方式
```
// l2TransactionBaseCost(uint256 _l1gasPrice,uint256 _l2GasLimit,uint256 _l2GasPerPubdataByteLimit)
cast call --rpc-url https://rpc.ankr.com/eth_goerli 0x1908e2bf4a88f91e4ef0dc72f02b8ea36bea2319 "l2TransactionBaseCost(uint256,uint256,uint256)" 7732618 1142406 800
```


#### 3、如果deposit 失败, 退款流程
```
claimFailedDeposit(
	address _depositSender,
	address _l1Token,
	bytes32 _l2TxHash,
	uint256 _l2BlockNumber,
	uint256 _l2MessageIndex,
	uint16 _l2TxNumberInBlock,
	bytes32[] calldata _merkleProof)
```





### l2 => l1:

####  1、withdraw(address _l1Receiver,address _l2Token,uint256 _amount)
* input
```
cast send --gas-price 250000000 --rpc-url https://testnet.era.zksync.dev --private-key 3e31923426ee6b71e7473bef2759520aa5b40b2446003bd4d43ca0070a9a109e 0x00ff932A6d70E2B8f1Eb4919e1e09C1923E7e57b "withdraw(address,address,uint256)" 0x20cD8eB93c50BDAc35d6A526f499c0104958e3F6 0x1A9BF9B377B49AFaAdDF1435595aBBE032554BbC  1000000000000000000
```
* out
```
....
transactionHash         0xdd62c574beb992db21f226864c27d0f967e112baa90d8d65f154326d69031ce5
```

#### 2、检测 tx(上面withdraw 的tx) 是否已经拥有的proof 数据
* input
```
curl -X POST -H "Content-Type: application/json" --data '{"jsonrpc": "2.0", "id": 1, "method": "zks_getL2ToL1LogProof", "params": [ "0x9b6515e714e1700b1190eb5e60b99250dab5a1631c1cde1a371a9b57a8092f53" ]}' "https://testnet.era.zksync.dev"
```
* out
```
{"jsonrpc":"2.0","result":{"id":25,"proof":["0x679f9a0338c5db971e20e97cb50486d36881713840279dc551a064e70d0428e0","0x5c59fb0afc05bf5df610be173c50a7d844f72b94b664e33bbbb9df199e438a5f","0xceea7e702c51aa03a8cc6f57278fcf147531ec8707376706db0040ef0ca2b1bc","0x591889c6a981811cb1a7cc7ba767696e1fa11f363d7d5927f3790252d8d28756","0x78c2ef59edf291cc01b6718932002b8b79422632f35ebb177c82960c7697b591","0xa35eb5bfc3ced39fb605da448aa711fe1b3df3933648efde864fc1a563862430","0x66d7c5983afe44cf15ea8cf565b34c6c31ff0cb4dd744524f7842b942d08770d","0xb04e5ee349086985f74b73971ce9dfe76bbed95c84906c5dffd96504e1e5396c","0xac506ecb5465659b3a927143f6d724f91d8d9c4bdb2463aee111d9aa869874db"],"root":"0x46fd8d258242e240a610a4f8b3938aa86a0f404dc1367d94a992e9807ea43e4d"},"id":1}
```

#### 3、获取l1BatchNumber, l1BatchTxIndex
* input
```
cast tx --rpc-url https://testnet.era.zksync.dev 0x9b6515e714e1700b1190eb5e60b99250dab5a1631c1cde1a371a9b57a8092f53
```

* out
```
...
l1BatchNumber        81038
l1BatchTxIndex       17
```


#### 4、finalizeWithdrawal(uint256 _l2BlockNumber,uint256 _l2MessageIndex,uint16 _l2TxNumberInBlock,bytes calldata _message,bytes32[] calldata _merkleProof)
* 注解
```
_l2BlockNumber: 在 tx 中l1BatchNumber
_l2MessageIndex: 在 rpc 请求 zks_getL2ToL1LogProof 时获得的 id
_l2TxNumberInBlock: 在 tx l1BatchTxIndex
_message: 在 withdraw tx 中 有一个 L1MessageSent事件,里面的 _message 便是
_merkleProof: 在 rpc 请求 zks_getL2ToL1LogProof 时获得的 proof
```
* input
```
// 可能需要等待 长时间等待. 等待 l2 将数据更新至l1种
cast send --rpc-url https://rpc.ankr.com/eth_goerli --private-key 3e31923426ee6b71e7473bef2759520aa5b40b2446003bd4d43ca0070a9a109e 0x927ddfcc55164a59e0f33918d13a2d559bc10ce7 "finalizeWithdrawal(uint256,uint256,uint16,bytes,bytes32[])" 81038 6 17 0x11a2ccc120cd8eb93c50bdac35d6a526f499c0104958e3f6113d7546f66555c8124a71a2886ac855272e4ab10000000000000000000000000000000000000000000000000de0b6b3a7640000 "[0x1e7940828364acf56140bceee6a4ad4c49d3103069275eb4bd2f2652bdaca0d0,0xa49175a04be3759fca2d725f8af49966290b0804b952e0c92c48a1750bab2e28,0x6be64c000681554d9d351a3d00adf70d00b0dccdf8986b5437051dc44e2092f3,0x205a1ce2499202511a7400f1f310f7169437a689bf623442de935658d51116d9,0xe4733f281f18ba3ea8775dd62d2fcd84011c8c938f16ea5790fd29a03bf8db89,0x1798a1fd9c8fbb818c98cff190daa7cc10b6e5ac9716b4a2649f7c2ebcef2272,0x66d7c5983afe44cf15ea8cf565b34c6c31ff0cb4dd744524f7842b942d08770d,0xb04e5ee349086985f74b73971ce9dfe76bbed95c84906c5dffd96504e1e5396c,0xac506ecb5465659b3a927143f6d724f91d8d9c4bdb2463aee111d9aa869874db]"
```
* out
```
...
transactionHash         0x333f0430b5438a8fcc59716edd47301d9314180a935ab46c940d387f5cf208be
transactionIndex        25
```
